sudo: false

os: linux

dist: trusty

python:
  - 3.6
  - 2.7

language: python

cache:
  directories:
  - $HOME/.chainer
  - $HOME/.cache/pip

notifications:
  email: false

branches:
  only:
    - master

install:
  - pip install opencv-python
  - pip install Cython
  - pip install .

script:
  - pip install hacking pytest
  - flake8 .
  - pytest -vs tests -m 'not gpu'

  # run example.
  - (cd examples/coco && ./convert_caffe2_to_chainer.py)

after_success:
  - rm -f dist/*.tar.gz
  - python setup.py sdist
  - pip install dist/*.tar.gz
